%% --Select Data and PulseLocationTimePoint--
%  --对于能进入排水口检测算法的所有样本进行整体测试--
%  author : YuSongHao
%  2018.05.08
%
clear;clc;
%  --排水口样本--
FilePath = ('E:\叶片样本库\故障\排水口');
cd(FilePath);
DataLoad = load('Ningxia_2.0MW_151358_Paishuikou.mat');
TimePoint = [16.85,24.735,32.851,40.851,49.254,57.582];%PSK151358
% DataLoad = load('Ningxia_2.0MW_134935_Paishuikou.mat');
% TimePoint = [41,47.6,54,60,66,71.6,76.7,81.7,86.3,90.8,95.1,99.7,104.1,108.5,113,117.6,122.1,126.8,131.4,136.1,141,145.8,150.6,155.4,160.1,165,170,174.8,179.7,184.8,190.1,195.1,200.3,205.5,210.8,215.8,221.1,226.2,231.6,237];%psk134935
% DataLoad = load('Ningxia_2.0MW_135813_Paishuikou.mat');
% TimePoint = [1.5,6.6,11.7,16.8,22,26.8,31.8,36.5,41.1,45.5,50,54.3,58.7,63.1,67.7,72.2,76.5,81,85.4,89.8,94.2,98.6,103.0,107.5,112,116.4,120.8,125.3,129.7,134.2,138.7,143.2,147.5,151.6,156.3,160.7,165.3,169.7,174.1,178.6,183,187.6,192,196.4,201,205.4,210,214.5,219.1,223.8,228.7,233.6,238.7,243.8,249.2,254.7,260.3,266.3,272.3,278.6,285.2,291.5,298.4];%psk135813


%  --雷击样本--
% FilePath = ('E:\叶片样本库\故障\雷击');
% cd(FilePath);
% DataLoad = load('Ningxia_2.0MW_143837_LightningStrike.mat');
% TimePoint = [7.1,14.5,21.8,29.1,36.4,43.8,51.1,58.4,65.7,72.8,80.2,87.6,95,102.4,109.7,117,124.2,131.4,138.7,146,153.4,160.7,168,175.4,182.7,190,197.5,204.9,212.3,219.6,227,234.6,242.2,249.7,257.46,265.1,273.1,280.9,289,297.2,305.4,313.8,322.2,330.4,338.4,346.2,353.7,360.8,368,375.1,382.4,389.8,397.1,404.4,411.6,419,426.4,433.7,440.8];%LS143837
% DataLoad = load('Ningxia_2.0MW_144705_LightningStrike.mat');
% TimePoint = [27.6,34.8,42.3,49.4,56.9,64.1,71.5,78.7,86,93.2,100.4,107.7,115,122.3,129.6,136.9,144.3,151.5,158.8,166.1,173.5,180.7,188,195.4,202.7,210,217.4,224.7,232,239.3,246.7,254.1,261.4,268.6,275.8,283.2,290.6,297.8,305.2,312.6,320,327.2,334.5,341.9,349.1];%LS144705
% DataLoad = load('Ningxia_2.0MW_143406_LightningStrike.mat ');
% TimePoint = [7.2,14.6,21.9,29.2,36.5,43.8,51.2,58.5,65.8,73.1,80.4,87.7,95,102.4,109.7,117.1,124.3,131.6,138.8,146.1,153.4,160.8,168,175.3,182.5];%LS143406
% DataLoad = load('Weifang_3.0MW_95114_LightningStrike.mat ');
% TimePoint = [0.5,7.8,15.1,22.4,29.6,36.8,44,51.4];%LS95114
% DataLoad = load('Weifang_3.0MW_95707_1_LightningStrike.mat');
% TimePoint = [1.3,8.6,16,23.2,30.5,37.8,45];%LS95707_1
% DataLoad = load('Weifang_3.0MW_95707_2_LightningStrike.mat');
% TimePoint = [2.8,10.1,17.4,24.7,32,39.3,46.6];%LS95707_2

%  --裂纹样本  
% FilePath = ('E:\叶片样本库\故障\开裂');
% cd(FilePath);
% DataLoad = load('Zhangjiakou_1.5MW_153000_Cracking.mat');
% TimePoint = [2.4,7.4,12.6,17.9,23.1,28.3,33.4,38.5,43.6,48.8,54,59.1,64.2,69.4,74.5,79.6,84.8,89.8,95,100.1,105.2,110.4,115.5,120.6,125.7,130.8,135.9,141,146.2,151.4,156.5,161.7,166.8,172,177.1,];%CK153000
% DataLoad = load('Zhangjiakou_1.5MW_154412_Cracking.mat');
% TimePoint = [3.1,8.4,13.5,18.5,23.6,28.6,33.65,38.6,43.6,48.6,53.6,58.7,63.7,68.7,73.6,78.5,83.6,88.55,93.5];%CK154412_1
% TimePoint = [113.8,118.8,123.8,128.8,133.77,138.7,143.9,148.9,153.8,158.9,164,169,173.9,179];%CK154412_2
% DataLoad = load('Zhangjiakou_1.5MW_155906_Cracking.mat ');
% TimePoint = [2.8,7.8,13,17.9,22.8,28,32.8,37.8,42.8,48,53,58,63,68,72.8,77.8,82.9,87.8,92.8,97.7,102.8,107.7,112.7,117.7,122.7,127.7,132.7,137.7,142.7,147.7,152.6];%CK155906
% DataLoad = load('Kangbao_2.0MW_101339_1_Cracking.mat');
% TimePoint = [1.3,6.4,11.3,16.2,21.1,25.9,31,36,41.2,46.1,51.1,56.1,61,65.8,70.4,75.1,79.6,84.2,88.6,93.1,97.6,102,106.5,110.8,115.1,119.6,124,128.6,133.1,137.8,142.4,146.9,151.3,155.7,160.1,164.7,174.5,179.8,185.4,191.1,197.1,202.9,208.5,213.9,229.2,234.3,239.5,244.7,250,255.1,260.3,265.5,270.7,276,281.1,286.1,291.1,295.9,300.8,305.6,310.1,318.8,323.2,327.3,331.5];%CK101339_1高速运转时极微弱
% DataLoad = load('Saihanba_2.0MW_115515_2_Cracking.mat');
% TimePoint = [5.6,10.76,15.87,21,26.16,31.5,36.8,42.3,47.37,52.3,57.37,62.26,67.23,72.27,77.26,82.28,87.3,92.4,97.6,102.59,107.56,112.66,117.7,122.76,127.64];%CK115515_1后沿开裂
% TimePoint = [172.6,177.7,182.7,187.7,192.7];%CK115515_2后沿开裂
% DataLoad = load('Saihanba_2.0MW_120132_2_Cracking.mat');
% TimePoint = [3.7,8.8,14,19.3,24.5,29.6,35,40.3,45.7,51.5,56.5,61.5,66.7,71.6,76.4,81.8,86.8,92,96.9,102,107.1,112.1,117.2,122.3,127.4];%CK120132后沿开裂
% DataLoad = load('Saihanba_2.0MW_120910_2_Cracking.mat ');
% TimePoint = [6.1,11.5,16.5,21.3,26.6,31.6,36.4,41.4,46.7,51.6,56.6,61.6,66.7,71.7,76.8,82.1,87.6,92.3,97.3,102.5,107.4,112.3,117.3,122.4,127.5,132.6,137.5,142.4,147.4,152.7,157.7,162.7,167.6,173,178];%CK120910后沿开裂
%% Subspectrum and Spectrum Peak Search
data = DataLoad.data;
Fs = 64000;
d = fdesign.bandpass('N,F3dB1,F3dB2', 32, 2000,20000, Fs);
hd = design(d,'butter');
data = filter(hd,data);
data = data(1,(TimePoint(1)-0.5)*Fs+1:(TimePoint(end))*Fs);
output = simplesubspec(data,1024,512,20,20,0.001);
FreqPeaks = specpeaksearch(output,Fs,2048);
% audiowrite('2K_PSK_output_3.wav',output,Fs);
% audiowrite('2K_PSK_original_3.wav',data,Fs);
